name: Security Scan

on:
    pull_request:
        branches: [main]
    workflow_dispatch:

jobs:
    gosec:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-go@v5
              with:
                  go-version-file: server/go.mod
            - name: Install gosec
              run: go install github.com/securego/gosec/v2/cmd/gosec@latest
            - name: Run gosec (server)
              run: gosec ./...
              working-directory: server
            - name: Run gosec (client-daemon)
              run: gosec ./...
              working-directory: client-daemon
    npm-audit:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: web-ui/package-lock.json
            - name: Install dependencies
              run: npm ci
              working-directory: web-ui
            - name: NPM Audit (prod)
              run: npm audit --production || true
              working-directory: web-ui
