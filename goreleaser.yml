version: 2
env: [CGO_ENABLED=0]
builds:
  - id: server
    dir: ./server
    main: ./cmd/server/main.go
    binary: goconnect-server
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.builtBy=orhaniscoding
    goos: [linux, darwin, windows]
    goarch: [amd64, arm64]
  - id: daemon
    dir: ./client-daemon
    main: ./cmd/daemon/main.go
    binary: goconnect-daemon
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.builtBy=orhaniscoding
    goos: [linux, darwin, windows]
    goarch: [amd64, arm64]
archives:
  - id: archive
    formats: [tar.gz]
    name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"
    files:
      - README.md
      - LICENSE
nfpms:
  - id: linux
    package_name: goconnect
    vendor: orhaniscoding
    maintainer: orhaniscoding
    description: "GoConnect â€” Host/Daemon"
    formats: [deb, rpm]
    contents:
      - src: ./client-daemon/service/linux/goconnect-daemon.service
        dst: /usr/lib/systemd/system/goconnect-daemon.service
        type: config
      - src: ./dist/server_{{ .Os }}_{{ .Arch }}/goconnect-server
        dst: /usr/local/bin/goconnect-server
      - src: ./dist/daemon_{{ .Os }}_{{ .Arch }}/goconnect-daemon
        dst: /usr/local/bin/goconnect-daemon
